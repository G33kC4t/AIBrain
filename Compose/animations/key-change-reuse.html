<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key å˜åŒ–æ—¶çš„å¤ç”¨é€»è¾‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Monaco', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            background: #0f0f23;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            border: 1px solid #333;
        }

        h2 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* åœºæ™¯é€‰æ‹© */
        .scenario-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: 2px solid #333;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #1a1a2e;
            color: #aaa;
        }

        .scenario-btn:hover {
            border-color: #00d9ff;
            color: #00d9ff;
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
            border-color: #00d9ff;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
        }

        .panel-title {
            font-size: 14px;
            font-weight: bold;
            color: #00d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: #00d9ff;
            border-radius: 2px;
        }

        /* å†³ç­–æµç¨‹å›¾ */
        .decision-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 11px;
        }

        .flow-node {
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
            max-width: 180px;
        }

        .flow-node.start {
            background: #1e3a5f;
            color: #5dade2;
            border: 2px solid #5dade2;
        }

        .flow-node.decision {
            background: #3d1e5f;
            color: #9b59b6;
            border: 2px solid #9b59b6;
            transform: rotate(0deg);
        }

        .flow-node.action {
            background: #1e5f3a;
            color: #58d68d;
            border: 2px solid #58d68d;
        }

        .flow-node.highlight {
            box-shadow: 0 0 20px currentColor;
            transform: scale(1.05);
        }

        .flow-arrow {
            color: #555;
            font-size: 16px;
        }

        .flow-arrow.highlight {
            color: #00d9ff;
        }

        .flow-branch {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .flow-branch-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .branch-label {
            font-size: 10px;
            color: #888;
            padding: 2px 8px;
            background: #0d1117;
            border-radius: 4px;
        }

        .branch-label.yes { color: #58d68d; }
        .branch-label.no { color: #ec7063; }

        /* æ•°æ®å±•ç¤ºåŒº */
        .data-section {
            margin-bottom: 20px;
        }

        .data-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .slot-card {
            background: #0d1117;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border: 2px solid #333;
            transition: all 0.4s ease;
        }

        .slot-card.active {
            border-color: #58d68d;
        }

        .slot-card.pool {
            border-color: #f5b041;
            opacity: 0.8;
        }

        .slot-card.match {
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
            animation: pulse 1s ease-in-out infinite;
        }

        .slot-card.reusing {
            border-color: #9b59b6;
            animation: slideTransform 0.6s ease;
        }

        .slot-card.creating {
            border-color: #5dade2;
            animation: fadeIn 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 15px rgba(0, 217, 255, 0.3); }
            50% { box-shadow: 0 0 25px rgba(0, 217, 255, 0.6); }
        }

        @keyframes slideTransform {
            0% { transform: translateX(50px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .slot-id {
            font-size: 12px;
            font-weight: bold;
            color: #00d9ff;
        }

        .slot-type {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .slot-type.text { background: rgba(93, 173, 226, 0.2); color: #5dade2; }
        .slot-type.image { background: rgba(155, 89, 182, 0.2); color: #9b59b6; }

        .slot-state {
            font-size: 10px;
            color: #888;
        }

        .slot-state span {
            color: #58d68d;
        }

        .empty-state {
            color: #555;
            font-size: 12px;
            text-align: center;
            padding: 20px;
        }

        /* æŸ¥æ‰¾è¯·æ±‚ */
        .request-box {
            background: rgba(0, 217, 255, 0.1);
            border: 2px solid #00d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .request-title {
            font-size: 12px;
            color: #00d9ff;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .request-params {
            display: flex;
            gap: 15px;
            font-size: 11px;
        }

        .param {
            background: #0d1117;
            padding: 6px 12px;
            border-radius: 4px;
        }

        .param-key {
            color: #888;
        }

        .param-value {
            color: #58d68d;
            font-weight: bold;
        }

        /* ç»“æœå±•ç¤º */
        .result-box {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .result-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .result-content {
            font-size: 13px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-icon {
            font-size: 20px;
        }

        .result-text {
            flex: 1;
        }

        .result-text strong {
            color: #00d9ff;
        }

        /* æ§åˆ¶åŒº */
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }

        .btn-secondary {
            background: #333;
            color: #aaa;
        }

        .btn-secondary:hover {
            background: #444;
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* è¯´æ˜åŒº */
        .explanation {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: #aaa;
            line-height: 1.6;
        }

        .explanation strong {
            color: #00d9ff;
        }

        .explanation code {
            background: #0d1117;
            padding: 2px 6px;
            border-radius: 4px;
            color: #58d68d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Key å˜åŒ–æ—¶çš„å¤ç”¨é€»è¾‘</h2>
        <p class="subtitle">slotId åŒ¹é… â†’ contentType åŒ¹é… â†’ ä»»æ„å¤ç”¨ â†’ æ–°å»º</p>

        <div class="scenario-selector">
            <button class="scenario-btn active" data-scenario="slotMatch">åœºæ™¯1: slotId ç²¾ç¡®åŒ¹é…</button>
            <button class="scenario-btn" data-scenario="typeMatch">åœºæ™¯2: contentType åŒ¹é…</button>
            <button class="scenario-btn" data-scenario="anyReuse">åœºæ™¯3: ä»»æ„å¤ç”¨</button>
            <button class="scenario-btn" data-scenario="createNew">åœºæ™¯4: æ–°å»º</button>
        </div>

        <div class="main-layout">
            <!-- å†³ç­–æµç¨‹ -->
            <div class="panel">
                <div class="panel-title">å¤ç”¨å†³ç­–æµç¨‹</div>
                <div class="decision-flow" id="decision-flow">
                    <div class="flow-node start" id="flow-start">éœ€è¦æ˜¾ç¤º slotId=X</div>
                    <div class="flow-arrow" id="arrow-1">â†“</div>
                    <div class="flow-node decision" id="flow-active">æ´»è·ƒåˆ—è¡¨æœ‰ X?</div>
                    <div class="flow-branch">
                        <div class="flow-branch-item">
                            <div class="branch-label yes">æ˜¯</div>
                            <div class="flow-node action" id="flow-direct">ç›´æ¥å¤ç”¨</div>
                        </div>
                        <div class="flow-branch-item">
                            <div class="branch-label no">å¦</div>
                            <div class="flow-arrow" id="arrow-2">â†“</div>
                        </div>
                    </div>
                    <div class="flow-node decision" id="flow-pool-slot">å¤ç”¨æ± æœ‰ slotId=X?</div>
                    <div class="flow-branch">
                        <div class="flow-branch-item">
                            <div class="branch-label yes">æ˜¯</div>
                            <div class="flow-node action" id="flow-slot-reuse">å¤ç”¨(ä¿ç•™çŠ¶æ€)</div>
                        </div>
                        <div class="flow-branch-item">
                            <div class="branch-label no">å¦</div>
                            <div class="flow-arrow" id="arrow-3">â†“</div>
                        </div>
                    </div>
                    <div class="flow-node decision" id="flow-pool-type">å¤ç”¨æ± æœ‰ç›¸åŒ contentType?</div>
                    <div class="flow-branch">
                        <div class="flow-branch-item">
                            <div class="branch-label yes">æ˜¯</div>
                            <div class="flow-node action" id="flow-type-reuse">å¤ç”¨(é‡ç½®çŠ¶æ€)</div>
                        </div>
                        <div class="flow-branch-item">
                            <div class="branch-label no">å¦</div>
                            <div class="flow-arrow" id="arrow-4">â†“</div>
                        </div>
                    </div>
                    <div class="flow-node decision" id="flow-pool-any">å¤ç”¨æ± æœ‰ä»»æ„å¯ç”¨?</div>
                    <div class="flow-branch">
                        <div class="flow-branch-item">
                            <div class="branch-label yes">æ˜¯</div>
                            <div class="flow-node action" id="flow-any-reuse">å¤ç”¨(å®Œå…¨é‡ç»„)</div>
                        </div>
                        <div class="flow-branch-item">
                            <div class="branch-label no">å¦</div>
                            <div class="flow-node action" id="flow-create">åˆ›å»ºæ–°çš„</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ´»è·ƒåˆ—è¡¨ -->
            <div class="panel">
                <div class="panel-title">æ´»è·ƒçš„ Subcomposition</div>
                <div id="active-container">
                    <div class="data-section" id="active-list"></div>
                </div>

                <div class="panel-title" style="margin-top: 20px;">å¤ç”¨æ± </div>
                <div id="pool-list"></div>
            </div>

            <!-- æŸ¥æ‰¾è¯·æ±‚ä¸ç»“æœ -->
            <div class="panel">
                <div class="panel-title">æŸ¥æ‰¾è¯·æ±‚</div>
                <div class="request-box" id="request-box">
                    <div class="request-title">subcompose() è°ƒç”¨</div>
                    <div class="request-params">
                        <div class="param">
                            <span class="param-key">slotId: </span>
                            <span class="param-value" id="req-slotId">-</span>
                        </div>
                        <div class="param">
                            <span class="param-key">contentType: </span>
                            <span class="param-value" id="req-contentType">-</span>
                        </div>
                    </div>
                </div>

                <div class="result-box" id="result-box" style="display: none;">
                    <div class="result-title">æŸ¥æ‰¾ç»“æœ</div>
                    <div class="result-content">
                        <span class="result-icon" id="result-icon">âœ…</span>
                        <div class="result-text" id="result-text"></div>
                    </div>
                </div>

                <div class="panel-title" style="margin-top: 20px;">çŠ¶æ€å˜åŒ–</div>
                <div id="state-info" class="slot-card" style="display: none;">
                    <div class="slot-header">
                        <span class="slot-id" id="state-id">-</span>
                    </div>
                    <div class="slot-state" id="state-detail"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="btn-next">æ‰§è¡ŒæŸ¥æ‰¾</button>
            <button class="btn btn-secondary" id="btn-reset">é‡ç½®</button>
        </div>

        <div class="explanation" id="explanation">
            <strong>ğŸ’¡ é€‰æ‹©åœºæ™¯æŸ¥çœ‹ä¸åŒçš„å¤ç”¨é€»è¾‘</strong><br>
            å¤ç”¨å†³ç­–éµå¾ªä¼˜å…ˆçº§ï¼šslotId ç²¾ç¡®åŒ¹é… > contentType åŒ¹é… > ä»»æ„å¯ç”¨ > æ–°å»º
        </div>
    </div>

    <script>
        let currentScenario = 'slotMatch';
        let currentStep = 0;

        const scenarios = {
            slotMatch: {
                name: 'slotId ç²¾ç¡®åŒ¹é…',
                request: { slotId: 'user_5', contentType: 'text' },
                activeSlots: [
                    { id: 'user_3', type: 'text', state: 'count=10' }
                ],
                poolSlots: [
                    { id: 'user_5', type: 'text', state: 'count=5' },
                    { id: 'user_7', type: 'image', state: '' }
                ],
                steps: [
                    { highlight: ['flow-start'], explanation: '<strong>ğŸ’¡ å¼€å§‹æŸ¥æ‰¾</strong><br>éœ€è¦æ˜¾ç¤º <code>slotId="user_5"</code>ï¼Œ<code>contentType="text"</code>' },
                    { highlight: ['flow-active'], matchActive: false, explanation: '<strong>ğŸ’¡ æ£€æŸ¥æ´»è·ƒåˆ—è¡¨</strong><br>æ´»è·ƒåˆ—è¡¨ä¸­æ²¡æœ‰ user_5' },
                    { highlight: ['flow-pool-slot'], matchPool: 'user_5', explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  slotId</strong><br>å¤ç”¨æ± ä¸­æ‰¾åˆ° <code>slotId="user_5"</code>ï¼è¿™æ˜¯æœ€ä½³åŒ¹é…' },
                    { highlight: ['flow-slot-reuse'], result: { icon: 'âœ…', text: '<strong>slotId ç²¾ç¡®åŒ¹é…</strong><br>å¤ç”¨ user_5ï¼Œremember çŠ¶æ€ <span style="color:#58d68d">å®Œæ•´ä¿ç•™</span> (count=5)' }, explanation: '<strong>ğŸ’¡ å¤ç”¨å¹¶ä¿ç•™çŠ¶æ€</strong><br>ç”±äº slotId å®Œå…¨åŒ¹é…ï¼Œä¹‹å‰ remember çš„çŠ¶æ€ (count=5) ä¼šè¢«ä¿ç•™ã€‚è¿™æ˜¯å¤ç”¨æ•ˆç‡æœ€é«˜çš„æƒ…å†µã€‚' }
                ]
            },
            typeMatch: {
                name: 'contentType åŒ¹é…',
                request: { slotId: 'user_8', contentType: 'text' },
                activeSlots: [
                    { id: 'user_3', type: 'text', state: 'active' }
                ],
                poolSlots: [
                    { id: 'user_5', type: 'text', state: 'count=5' },
                    { id: 'user_7', type: 'image', state: '' }
                ],
                steps: [
                    { highlight: ['flow-start'], explanation: '<strong>ğŸ’¡ å¼€å§‹æŸ¥æ‰¾</strong><br>éœ€è¦æ˜¾ç¤º <code>slotId="user_8"</code>ï¼Œ<code>contentType="text"</code>' },
                    { highlight: ['flow-active'], matchActive: false, explanation: '<strong>ğŸ’¡ æ£€æŸ¥æ´»è·ƒåˆ—è¡¨</strong><br>æ´»è·ƒåˆ—è¡¨ä¸­æ²¡æœ‰ user_8' },
                    { highlight: ['flow-pool-slot'], matchPool: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  slotId</strong><br>å¤ç”¨æ± ä¸­æ²¡æœ‰ <code>slotId="user_8"</code>' },
                    { highlight: ['flow-pool-type'], matchPoolType: 'text', explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  contentType</strong><br>æ‰¾åˆ°ç›¸åŒç±»å‹ <code>contentType="text"</code> çš„ user_5' },
                    { highlight: ['flow-type-reuse'], result: { icon: 'â™»ï¸', text: '<strong>contentType åŒ¹é…</strong><br>å¤ç”¨ user_5 â†’ user_8ï¼ŒçŠ¶æ€ <span style="color:#f5b041">é‡ç½®</span>' }, stateChange: { id: 'user_5 â†’ user_8', detail: 'slotId ä¸åŒï¼Œremember çŠ¶æ€é‡æ–°åˆå§‹åŒ–' }, explanation: '<strong>ğŸ’¡ å¤ç”¨ä½†é‡ç½®çŠ¶æ€</strong><br>è™½ç„¶å¤ç”¨äº† Subcompositionï¼Œä½† slotId ä¸åŒï¼Œæ‰€ä»¥ remember ä¼šé‡æ–°æ‰§è¡Œï¼ŒçŠ¶æ€ä¼šé‡ç½®ã€‚ä¸è¿‡ç»“æ„ç›¸åŒï¼Œé‡ç»„å¼€é”€è¾ƒå°ã€‚' }
                ]
            },
            anyReuse: {
                name: 'ä»»æ„å¤ç”¨',
                request: { slotId: 'video_1', contentType: 'video' },
                activeSlots: [],
                poolSlots: [
                    { id: 'user_5', type: 'text', state: '' },
                    { id: 'img_3', type: 'image', state: '' }
                ],
                steps: [
                    { highlight: ['flow-start'], explanation: '<strong>ğŸ’¡ å¼€å§‹æŸ¥æ‰¾</strong><br>éœ€è¦æ˜¾ç¤º <code>slotId="video_1"</code>ï¼Œ<code>contentType="video"</code>' },
                    { highlight: ['flow-active'], matchActive: false, explanation: '<strong>ğŸ’¡ æ£€æŸ¥æ´»è·ƒåˆ—è¡¨</strong><br>æ´»è·ƒåˆ—è¡¨ä¸ºç©º' },
                    { highlight: ['flow-pool-slot'], matchPool: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  slotId</strong><br>å¤ç”¨æ± ä¸­æ²¡æœ‰ video_1' },
                    { highlight: ['flow-pool-type'], matchPoolType: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  contentType</strong><br>å¤ç”¨æ± ä¸­æ²¡æœ‰ <code>contentType="video"</code>' },
                    { highlight: ['flow-pool-any'], matchAny: 'user_5', explanation: '<strong>ğŸ’¡ æ£€æŸ¥ä»»æ„å¯ç”¨</strong><br>å¤ç”¨æ± ä¸ä¸ºç©ºï¼Œå¯ä»¥å–å‡ºä»»æ„ä¸€ä¸ª (user_5)' },
                    { highlight: ['flow-any-reuse'], result: { icon: 'âš ï¸', text: '<strong>ä»»æ„å¤ç”¨</strong><br>å¤ç”¨ user_5 â†’ video_1ï¼Œéœ€è¦ <span style="color:#ec7063">å®Œå…¨é‡ç»„</span>' }, stateChange: { id: 'user_5 â†’ video_1', detail: 'ç»“æ„å®Œå…¨ä¸åŒ (textâ†’video)ï¼Œé‡ç»„å¼€é”€å¤§' }, explanation: '<strong>ğŸ’¡ ä»»æ„å¤ç”¨ï¼ˆæ•ˆç‡è¾ƒä½ï¼‰</strong><br>è™½ç„¶é¿å…äº†åˆ›å»ºæ–° Subcomposition çš„å¼€é”€ï¼Œä½†ç»“æ„å®Œå…¨ä¸åŒï¼Œéœ€è¦å®Œå…¨é‡ç»„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨ contentType çš„åŸå› ã€‚' }
                ]
            },
            createNew: {
                name: 'æ–°å»º',
                request: { slotId: 'chat_1', contentType: 'chat' },
                activeSlots: [
                    { id: 'user_3', type: 'text', state: 'active' }
                ],
                poolSlots: [],
                steps: [
                    { highlight: ['flow-start'], explanation: '<strong>ğŸ’¡ å¼€å§‹æŸ¥æ‰¾</strong><br>éœ€è¦æ˜¾ç¤º <code>slotId="chat_1"</code>ï¼Œ<code>contentType="chat"</code>' },
                    { highlight: ['flow-active'], matchActive: false, explanation: '<strong>ğŸ’¡ æ£€æŸ¥æ´»è·ƒåˆ—è¡¨</strong><br>æ´»è·ƒåˆ—è¡¨ä¸­æ²¡æœ‰ chat_1' },
                    { highlight: ['flow-pool-slot'], matchPool: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  slotId</strong><br>å¤ç”¨æ± ä¸ºç©º' },
                    { highlight: ['flow-pool-type'], matchPoolType: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥å¤ç”¨æ±  contentType</strong><br>å¤ç”¨æ± ä¸ºç©º' },
                    { highlight: ['flow-pool-any'], matchAny: null, explanation: '<strong>ğŸ’¡ æ£€æŸ¥ä»»æ„å¯ç”¨</strong><br>å¤ç”¨æ± ä¸ºç©ºï¼Œæ— å¯å¤ç”¨é¡¹' },
                    { highlight: ['flow-create'], result: { icon: 'ğŸ†•', text: '<strong>åˆ›å»ºæ–°çš„</strong><br>åˆ†é…æ–°çš„ SlotTable å’Œ LayoutNode' }, stateChange: { id: 'chat_1 (æ–°å»º)', detail: 'åˆ›å»ºå…¨æ–°çš„ Subcompositionï¼Œå¼€é”€æœ€å¤§' }, explanation: '<strong>ğŸ’¡ åˆ›å»ºæ–°çš„ Subcomposition</strong><br>å¤ç”¨æ± ä¸ºç©ºï¼Œåªèƒ½åˆ›å»ºæ–°çš„ã€‚è¿™æ˜¯å¼€é”€æœ€å¤§çš„æƒ…å†µï¼Œéœ€è¦åˆ†é…æ–°çš„ SlotTable å’Œ LayoutNodeã€‚' }
                ]
            }
        };

        function renderActiveList(scenario, matchId) {
            const container = document.getElementById('active-list');
            const slots = scenario.activeSlots;

            if (slots.length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— æ´»è·ƒçš„ Subcomposition</div>';
                return;
            }

            container.innerHTML = slots.map(s => `
                <div class="slot-card active ${s.id === matchId ? 'match' : ''}">
                    <div class="slot-header">
                        <span class="slot-id">slotId="${s.id}"</span>
                        <span class="slot-type ${s.type}">${s.type}</span>
                    </div>
                    <div class="slot-state">${s.state}</div>
                </div>
            `).join('');
        }

        function renderPoolList(scenario, matchId, matchType) {
            const container = document.getElementById('pool-list');
            const slots = scenario.poolSlots;

            if (slots.length === 0) {
                container.innerHTML = '<div class="empty-state">å¤ç”¨æ± ä¸ºç©º</div>';
                return;
            }

            container.innerHTML = slots.map(s => {
                let extraClass = '';
                if (s.id === matchId) extraClass = 'match';
                else if (matchType && s.type === matchType) extraClass = 'match';
                return `
                    <div class="slot-card pool ${extraClass}">
                        <div class="slot-header">
                            <span class="slot-id">slotId="${s.id}"</span>
                            <span class="slot-type ${s.type}">${s.type}</span>
                        </div>
                        <div class="slot-state">${s.state ? `remember: ${s.state}` : ''}</div>
                    </div>
                `;
            }).join('');
        }

        function updateRequest(req) {
            document.getElementById('req-slotId').textContent = `"${req.slotId}"`;
            document.getElementById('req-contentType').textContent = `"${req.contentType}"`;
        }

        function highlightFlow(ids) {
            document.querySelectorAll('.flow-node').forEach(el => el.classList.remove('highlight'));
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.add('highlight');
            });
        }

        function showResult(result) {
            const box = document.getElementById('result-box');
            box.style.display = 'block';
            document.getElementById('result-icon').textContent = result.icon;
            document.getElementById('result-text').innerHTML = result.text;
        }

        function showStateChange(state) {
            const box = document.getElementById('state-info');
            box.style.display = 'block';
            document.getElementById('state-id').textContent = state.id;
            document.getElementById('state-detail').innerHTML = state.detail;
        }

        function executeStep() {
            const scenario = scenarios[currentScenario];
            const step = scenario.steps[currentStep];

            document.getElementById('explanation').innerHTML = step.explanation;
            highlightFlow(step.highlight);

            // é«˜äº®åŒ¹é…é¡¹
            if (step.matchActive !== undefined) {
                renderActiveList(scenario, step.matchActive ? scenario.request.slotId : null);
            }
            if (step.matchPool !== undefined) {
                renderPoolList(scenario, step.matchPool, null);
            }
            if (step.matchPoolType !== undefined) {
                renderPoolList(scenario, null, step.matchPoolType);
            }
            if (step.matchAny !== undefined) {
                if (step.matchAny) {
                    renderPoolList(scenario, step.matchAny, null);
                }
            }
            if (step.result) {
                showResult(step.result);
            }
            if (step.stateChange) {
                showStateChange(step.stateChange);
            }
        }

        function nextStep() {
            const scenario = scenarios[currentScenario];
            if (currentStep < scenario.steps.length - 1) {
                currentStep++;
                executeStep();
            }
            document.getElementById('btn-next').disabled = currentStep >= scenario.steps.length - 1;
        }

        function reset() {
            currentStep = 0;
            const scenario = scenarios[currentScenario];

            updateRequest(scenario.request);
            renderActiveList(scenario, null);
            renderPoolList(scenario, null, null);

            document.getElementById('result-box').style.display = 'none';
            document.getElementById('state-info').style.display = 'none';
            document.getElementById('btn-next').disabled = false;

            highlightFlow([]);
            document.getElementById('explanation').innerHTML = scenarios[currentScenario].steps[0].explanation;
        }

        function selectScenario(name) {
            currentScenario = name;
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.scenario === name);
            });
            reset();
        }

        // äº‹ä»¶ç»‘å®š
        document.querySelectorAll('.scenario-btn').forEach(btn => {
            btn.addEventListener('click', () => selectScenario(btn.dataset.scenario));
        });
        document.getElementById('btn-next').addEventListener('click', nextStep);
        document.getElementById('btn-reset').addEventListener('click', reset);

        // åˆå§‹åŒ–
        reset();
    </script>
</body>
</html>
