<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡ç»„æ—¶ SlotTable å˜åŒ–å¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Monaco', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            background: #0f0f23;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            border: 1px solid #333;
        }

        h2 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .scenario-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: 2px solid #333;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #1a1a2e;
            color: #aaa;
        }

        .scenario-btn:hover {
            border-color: #00d9ff;
            color: #00d9ff;
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
            border-color: #00d9ff;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
        }

        .panel.full-width {
            grid-column: 1 / -1;
        }

        .panel-title {
            font-size: 14px;
            font-weight: bold;
            color: #00d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: #00d9ff;
            border-radius: 2px;
        }

        /* ä»£ç é¢æ¿ */
        .code-container {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.8;
            overflow-x: auto;
        }

        .code-line {
            display: flex;
            padding: 2px 0;
            transition: background 0.3s ease;
        }

        .code-line.highlight {
            background: rgba(0, 217, 255, 0.15);
            border-left: 3px solid #00d9ff;
            margin-left: -15px;
            padding-left: 12px;
        }

        .code-line.changed {
            background: rgba(255, 215, 0, 0.15);
            border-left: 3px solid #ffd700;
            margin-left: -15px;
            padding-left: 12px;
        }

        .line-num {
            color: #555;
            width: 25px;
            text-align: right;
            margin-right: 15px;
            user-select: none;
        }

        .code-content {
            color: #e6e6e6;
        }

        .keyword { color: #ff79c6; }
        .string { color: #f1fa8c; }
        .function { color: #8be9fd; }
        .comment { color: #6272a4; }
        .variable { color: #50fa7b; }

        /* SlotTable å¯è§†åŒ– */
        .slottable-visual {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .array-section {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
        }

        .array-label {
            color: #00d9ff;
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .array-container {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            align-items: center;
        }

        .group-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            background: #2d5a87;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        .group-cell.node-group {
            background: #5a2d87;
        }

        .group-cell .group-key {
            font-size: 11px;
            color: #fff;
            font-weight: bold;
        }

        .group-cell .group-type {
            font-size: 9px;
            color: #aaa;
            margin-top: 2px;
        }

        .group-cell.highlight {
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .group-cell.updating {
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: pulse 0.5s ease infinite;
        }

        .group-cell.deleted {
            opacity: 0.3;
            border-color: #ff6b6b;
            text-decoration: line-through;
        }

        .group-cell.new {
            border-color: #00ff88;
            background: #1a5a1a;
            animation: fadeIn 0.5s ease;
        }

        .group-cell.unchanged {
            opacity: 0.6;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Slots æ•°ç»„ */
        .slot-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            border-radius: 4px;
            background: #333;
            font-size: 11px;
            color: #aaa;
            border: 1px solid #444;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .slot-cell.highlight {
            border-color: #00d9ff;
            color: #fff;
        }

        .slot-cell.updating {
            border-color: #ffd700;
            background: #3d3d1a;
            color: #ffd700;
        }

        .slot-cell.old-value {
            text-decoration: line-through;
            opacity: 0.5;
        }

        .slot-cell.new-value {
            background: #1a3d1a;
            border-color: #00ff88;
            color: #00ff88;
        }

        /* Gap æ˜¾ç¤º */
        .gap-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 15px;
            background: repeating-linear-gradient(
                45deg,
                #1a1a2e,
                #1a1a2e 5px,
                #2a2a3e 5px,
                #2a2a3e 10px
            );
            border: 2px dashed #555;
            border-radius: 6px;
            color: #666;
            font-size: 11px;
        }

        /* çŠ¶æ€é¢æ¿ */
        .state-info {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .state-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #222;
            font-size: 12px;
        }

        .state-row:last-child {
            border-bottom: none;
        }

        .state-label {
            color: #888;
        }

        .state-value {
            color: #00d9ff;
            font-weight: bold;
        }

        .state-value.changed {
            color: #ffd700;
        }

        /* è¯´æ˜ */
        .info-panel {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .info-content {
            color: #aaa;
            font-size: 12px;
            line-height: 1.8;
        }

        .info-content .highlight-text {
            color: #00ff88;
            font-weight: bold;
        }

        .info-content .warning-text {
            color: #ff6b6b;
        }

        .info-content .update-text {
            color: #ffd700;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
        }

        .control-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 217, 255, 0.4);
        }

        .control-btn.secondary {
            background: #333;
            color: #fff;
        }

        .control-btn.secondary:hover {
            background: #444;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #333;
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: #00d9ff;
        }

        .step-dot.completed {
            background: #00ff88;
        }

        /* å›¾ä¾‹ */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #888;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.unchanged { background: #2d5a87; opacity: 0.6; }
        .legend-color.updating { background: #3d3d1a; border: 1px solid #ffd700; }
        .legend-color.deleted { background: #5a1a1a; border: 1px solid #ff6b6b; }
        .legend-color.new { background: #1a5a1a; border: 1px solid #00ff88; }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>é‡ç»„æ—¶ SlotTable å˜åŒ–å¯è§†åŒ–</h2>
        <p class="subtitle">ä¸‰ç§å…¸å‹é‡ç»„åœºæ™¯ï¼šæ•°æ®æ›´æ–°ã€ç»“æ„å˜åŒ–ã€åˆ—è¡¨æ“ä½œ</p>

        <div class="scenario-selector">
            <button class="scenario-btn active" onclick="selectScenario(0)">åœºæ™¯1: æ•°æ®æ›´æ–°</button>
            <button class="scenario-btn" onclick="selectScenario(1)">åœºæ™¯2: æ¡ä»¶åˆ†æ”¯åˆ‡æ¢</button>
            <button class="scenario-btn" onclick="selectScenario(2)">åœºæ™¯3: åˆ—è¡¨é¡¹å˜åŒ–</button>
        </div>

        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šä»£ç  -->
            <div class="panel">
                <div class="panel-title">Composable ä»£ç </div>
                <div class="code-container" id="code-panel"></div>

                <div class="state-info">
                    <div class="state-row">
                        <span class="state-label">çŠ¶æ€å˜åŒ–:</span>
                        <span class="state-value" id="state-change">-</span>
                    </div>
                    <div class="state-row">
                        <span class="state-label">Groups æ•°ç»„å˜åŒ–:</span>
                        <span class="state-value" id="groups-change">ä¸å˜</span>
                    </div>
                    <div class="state-row">
                        <span class="state-label">Slots æ•°ç»„å˜åŒ–:</span>
                        <span class="state-value" id="slots-change">ä¸å˜</span>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šSlotTable -->
            <div class="panel">
                <div class="panel-title">SlotTable çŠ¶æ€</div>
                <div class="slottable-visual">
                    <div class="array-section">
                        <div class="array-label">groups æ•°ç»„</div>
                        <div class="array-container" id="groups-array"></div>
                    </div>
                    <div class="array-section">
                        <div class="array-label">slots æ•°ç»„</div>
                        <div class="array-container" id="slots-array"></div>
                    </div>
                </div>

                <div class="info-panel">
                    <div class="info-content" id="info-text">
                        ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹æ¼”ç¤º
                    </div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color unchanged"></div>
                <span>æœªå˜åŒ–</span>
            </div>
            <div class="legend-item">
                <div class="legend-color updating"></div>
                <span>æ­£åœ¨æ›´æ–°</span>
            </div>
            <div class="legend-item">
                <div class="legend-color deleted"></div>
                <span>å·²åˆ é™¤</span>
            </div>
            <div class="legend-item">
                <div class="legend-color new"></div>
                <span>æ–°æ’å…¥</span>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn secondary" onclick="reset()">é‡ç½®</button>
            <button class="control-btn primary" id="next-btn" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
        </div>

        <div class="step-indicator" id="step-indicator"></div>
    </div>

    <script>
        const scenarios = [
            // åœºæ™¯1: æ•°æ®æ›´æ–°
            {
                name: "æ•°æ®æ›´æ–°",
                code: [
                    { text: '@Composable', cls: 'keyword' },
                    { text: 'fun Counter() {', cls: '' },
                    { text: '    var count by remember { mutableStateOf(0) }', cls: '', highlight: false },
                    { text: '', cls: '' },
                    { text: '    Text("Count: $count")', cls: '', highlight: false },
                    { text: '    Button(onClick = { count++ }) {', cls: '' },
                    { text: '        Text("Increment")', cls: '' },
                    { text: '    }', cls: '' },
                    { text: '}', cls: '' }
                ],
                steps: [
                    {
                        phase: "initial",
                        stateChange: "count = 0",
                        groups: [
                            { key: "Counter", type: "Restartable" },
                            { key: "remember", type: "Group" },
                            { key: "Text", type: "Node", state: "" },
                            { key: "Button", type: "Node" },
                            { key: "Text", type: "Node" }
                        ],
                        slots: [
                            { value: "State(0)", state: "" },
                            { value: '"Count: 0"', state: "" },
                            { value: "ButtonNode", state: "" },
                            { value: '"Increment"', state: "" }
                        ],
                        highlightCode: [],
                        groupsChange: "ä¸å˜",
                        slotsChange: "ä¸å˜",
                        info: "é¦–æ¬¡ç»„åˆåçš„ SlotTable çŠ¶æ€ã€‚<br><span class='highlight-text'>count = 0</span>"
                    },
                    {
                        phase: "trigger",
                        stateChange: "count: 0 â†’ 1",
                        groups: [
                            { key: "Counter", type: "Restartable", state: "highlight" },
                            { key: "remember", type: "Group" },
                            { key: "Text", type: "Node" },
                            { key: "Button", type: "Node" },
                            { key: "Text", type: "Node" }
                        ],
                        slots: [
                            { value: "State(0)", state: "updating" },
                            { value: '"Count: 0"', state: "" },
                            { value: "ButtonNode", state: "" },
                            { value: '"Increment"', state: "" }
                        ],
                        highlightCode: [2],
                        groupsChange: "ä¸å˜",
                        slotsChange: '<span class="changed">State å€¼å˜åŒ–</span>',
                        info: "ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œ<span class='update-text'>count ä» 0 å˜ä¸º 1</span>ã€‚<br>è§¦å‘ Counter çš„é‡ç»„ã€‚"
                    },
                    {
                        phase: "recompose",
                        stateChange: "count = 1",
                        groups: [
                            { key: "Counter", type: "Restartable" },
                            { key: "remember", type: "Group", state: "unchanged" },
                            { key: "Text", type: "Node", state: "updating" },
                            { key: "Button", type: "Node", state: "unchanged" },
                            { key: "Text", type: "Node", state: "unchanged" }
                        ],
                        slots: [
                            { value: "State(1)", state: "new-value" },
                            { value: '"Count: 1"', state: "updating" },
                            { value: "ButtonNode", state: "" },
                            { value: '"Increment"', state: "" }
                        ],
                        highlightCode: [4],
                        groupsChange: '<span class="highlight-text">ä¸å˜</span>',
                        slotsChange: '<span class="changed">æ›´æ–° 2 ä¸ªå€¼</span>',
                        info: "é‡ç»„æ‰§è¡Œï¼š<br>1. remember çš„ key åŒ¹é…ï¼Œ<span class='highlight-text'>è·³è¿‡</span><br>2. Text çš„å‚æ•°å˜åŒ–ï¼Œ<span class='update-text'>æ›´æ–° slot å€¼</span><br>3. Button æœªå˜åŒ–ï¼Œ<span class='highlight-text'>è·³è¿‡</span>"
                    },
                    {
                        phase: "complete",
                        stateChange: "count = 1",
                        groups: [
                            { key: "Counter", type: "Restartable" },
                            { key: "remember", type: "Group" },
                            { key: "Text", type: "Node" },
                            { key: "Button", type: "Node" },
                            { key: "Text", type: "Node" }
                        ],
                        slots: [
                            { value: "State(1)", state: "" },
                            { value: '"Count: 1"', state: "new-value" },
                            { value: "ButtonNode", state: "" },
                            { value: '"Increment"', state: "" }
                        ],
                        highlightCode: [],
                        groupsChange: '<span class="highlight-text">ä¸å˜ (æœ€ä¼˜)</span>',
                        slotsChange: '<span class="changed">ä»…æ›´æ–°å€¼</span>',
                        info: "âœ… é‡ç»„å®Œæˆï¼<br><br><span class='highlight-text'>Groups æ•°ç»„å®Œå…¨ä¸å˜</span>ï¼Œåªæœ‰ Slots ä¸­çš„å€¼è¢«æ›´æ–°ã€‚<br>è¿™æ˜¯<span class='highlight-text'>æ€§èƒ½æœ€å¥½</span>çš„é‡ç»„åœºæ™¯ï¼"
                    }
                ]
            },
            // åœºæ™¯2: æ¡ä»¶åˆ†æ”¯åˆ‡æ¢
            {
                name: "æ¡ä»¶åˆ†æ”¯åˆ‡æ¢",
                code: [
                    { text: '@Composable', cls: 'keyword' },
                    { text: 'fun Conditional(showA: Boolean) {', cls: '' },
                    { text: '    if (showA) {', cls: '', highlight: false },
                    { text: '        Text("Content A")', cls: '' },
                    { text: '        Icon(Icons.A)', cls: '' },
                    { text: '    } else {', cls: '' },
                    { text: '        Text("Content B")', cls: '' },
                    { text: '    }', cls: '' },
                    { text: '}', cls: '' }
                ],
                steps: [
                    {
                        phase: "initial",
                        stateChange: "showA = true",
                        groups: [
                            { key: "Conditional", type: "Restartable" },
                            { key: "if#A", type: "Replaceable" },
                            { key: "Text-A", type: "Node" },
                            { key: "Icon-A", type: "Node" }
                        ],
                        slots: [
                            { value: '"Content A"', state: "" },
                            { value: "IconNode", state: "" }
                        ],
                        highlightCode: [2, 3, 4],
                        groupsChange: "ä¸å˜",
                        slotsChange: "ä¸å˜",
                        info: "showA = trueï¼Œæ˜¾ç¤º<span class='highlight-text'>åˆ†æ”¯ A</span> çš„å†…å®¹ã€‚<br>åŒ…å« Text å’Œ Icon ä¸¤ä¸ªç»„ä»¶ã€‚"
                    },
                    {
                        phase: "trigger",
                        stateChange: "showA: true â†’ false",
                        groups: [
                            { key: "Conditional", type: "Restartable", state: "highlight" },
                            { key: "if#A", type: "Replaceable", state: "updating" },
                            { key: "Text-A", type: "Node" },
                            { key: "Icon-A", type: "Node" }
                        ],
                        slots: [
                            { value: '"Content A"', state: "" },
                            { value: "IconNode", state: "" }
                        ],
                        highlightCode: [2],
                        groupsChange: '<span class="changed">å³å°†å˜åŒ–</span>',
                        slotsChange: '<span class="changed">å³å°†å˜åŒ–</span>',
                        info: "çŠ¶æ€å˜åŒ–ï¼š<span class='update-text'>showA å˜ä¸º false</span><br>æ¡ä»¶åˆ†æ”¯éœ€è¦åˆ‡æ¢ï¼"
                    },
                    {
                        phase: "delete",
                        stateChange: "showA = false",
                        groups: [
                            { key: "Conditional", type: "Restartable" },
                            { key: "if#A", type: "Replaceable", state: "deleted" },
                            { key: "Text-A", type: "Node", state: "deleted" },
                            { key: "Icon-A", type: "Node", state: "deleted" }
                        ],
                        slots: [
                            { value: '"Content A"', state: "old-value" },
                            { value: "IconNode", state: "old-value" }
                        ],
                        highlightCode: [3, 4],
                        groupsChange: '<span class="warning-text">åˆ é™¤ 3 ä¸ª Group</span>',
                        slotsChange: '<span class="warning-text">åˆ é™¤å¯¹åº” Slots</span>',
                        info: "åˆ†æ”¯ A çš„ key ä¸åˆ†æ”¯ B ä¸åŒ¹é…ï¼<br><span class='warning-text'>åˆ é™¤</span>åˆ†æ”¯ A çš„æ‰€æœ‰ Groupï¼š<br>- if#Aã€Text-Aã€Icon-A"
                    },
                    {
                        phase: "insert",
                        stateChange: "showA = false",
                        groups: [
                            { key: "Conditional", type: "Restartable" },
                            { key: "if#B", type: "Replaceable", state: "new" },
                            { key: "Text-B", type: "Node", state: "new" }
                        ],
                        slots: [
                            { value: '"Content B"', state: "new-value" }
                        ],
                        highlightCode: [6],
                        groupsChange: '<span class="highlight-text">æ’å…¥ 2 ä¸ª Group</span>',
                        slotsChange: '<span class="highlight-text">æ’å…¥æ–° Slots</span>',
                        info: "<span class='highlight-text'>æ’å…¥</span>åˆ†æ”¯ B çš„ Groupï¼š<br>- if#Bã€Text-B<br><br>åˆ†æ”¯ B åªæœ‰ 1 ä¸ªç»„ä»¶ï¼Œç»“æ„æ›´ç®€å•ã€‚"
                    },
                    {
                        phase: "complete",
                        stateChange: "showA = false",
                        groups: [
                            { key: "Conditional", type: "Restartable" },
                            { key: "if#B", type: "Replaceable" },
                            { key: "Text-B", type: "Node" }
                        ],
                        slots: [
                            { value: '"Content B"', state: "" }
                        ],
                        highlightCode: [],
                        groupsChange: '<span class="changed">ç»“æ„å·²æ”¹å˜</span>',
                        slotsChange: '<span class="changed">æ•°æ®å·²æ”¹å˜</span>',
                        info: "âœ… åˆ†æ”¯åˆ‡æ¢å®Œæˆï¼<br><br>âš ï¸ æ³¨æ„ï¼šåˆ†æ”¯ A ä¸­çš„æ‰€æœ‰ <span class='warning-text'>remember çŠ¶æ€</span>éƒ½å·²ä¸¢å¤±ï¼<br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å°½é‡<span class='highlight-text'>ä¿æŒç»“æ„ç¨³å®š</span>ã€‚"
                    }
                ]
            },
            // åœºæ™¯3: åˆ—è¡¨é¡¹å˜åŒ–
            {
                name: "åˆ—è¡¨é¡¹å˜åŒ–",
                code: [
                    { text: '@Composable', cls: 'keyword' },
                    { text: 'fun ItemList(items: List<String>) {', cls: '' },
                    { text: '    items.forEach { item ->', cls: '' },
                    { text: '        key(item) {', cls: '', highlight: false },
                    { text: '            ListItem(item)', cls: '' },
                    { text: '        }', cls: '' },
                    { text: '    }', cls: '' },
                    { text: '}', cls: '' }
                ],
                steps: [
                    {
                        phase: "initial",
                        stateChange: 'items = ["A", "B", "C"]',
                        groups: [
                            { key: "ItemList", type: "Restartable" },
                            { key: 'key="A"', type: "Movable" },
                            { key: "Item-A", type: "Node" },
                            { key: 'key="B"', type: "Movable" },
                            { key: "Item-B", type: "Node" },
                            { key: 'key="C"', type: "Movable" },
                            { key: "Item-C", type: "Node" }
                        ],
                        slots: [
                            { value: '"A"', state: "" },
                            { value: '"B"', state: "" },
                            { value: '"C"', state: "" }
                        ],
                        highlightCode: [3, 4],
                        groupsChange: "ä¸å˜",
                        slotsChange: "ä¸å˜",
                        info: "åˆ—è¡¨åŒ…å« 3 ä¸ªé¡¹ç›®ï¼šA, B, C<br>æ¯ä¸ªé¡¹ç›®ä½¿ç”¨ <span class='highlight-text'>key(item)</span> åŒ…è£¹ï¼Œåˆ›å»º Movable Groupã€‚"
                    },
                    {
                        phase: "trigger",
                        stateChange: 'items: ["A","B","C"] â†’ ["C","A","B"]',
                        groups: [
                            { key: "ItemList", type: "Restartable", state: "highlight" },
                            { key: 'key="A"', type: "Movable" },
                            { key: "Item-A", type: "Node" },
                            { key: 'key="B"', type: "Movable" },
                            { key: "Item-B", type: "Node" },
                            { key: 'key="C"', type: "Movable" },
                            { key: "Item-C", type: "Node" }
                        ],
                        slots: [
                            { value: '"A"', state: "" },
                            { value: '"B"', state: "" },
                            { value: '"C"', state: "" }
                        ],
                        highlightCode: [2],
                        groupsChange: '<span class="changed">å³å°†å˜åŒ–</span>',
                        slotsChange: "ä¸å˜",
                        info: "åˆ—è¡¨é¡ºåºå˜åŒ–ï¼<br>ä» [A, B, C] å˜ä¸º <span class='update-text'>[C, A, B]</span><br><br>Compose ä¼šå°è¯•<span class='highlight-text'>ç§»åŠ¨</span>è€Œéé‡å»ºã€‚"
                    },
                    {
                        phase: "search",
                        stateChange: 'items = ["C", "A", "B"]',
                        groups: [
                            { key: "ItemList", type: "Restartable" },
                            { key: 'key="A"', type: "Movable", state: "updating" },
                            { key: "Item-A", type: "Node" },
                            { key: 'key="B"', type: "Movable" },
                            { key: "Item-B", type: "Node" },
                            { key: 'key="C"', type: "Movable", state: "highlight" },
                            { key: "Item-C", type: "Node" }
                        ],
                        slots: [
                            { value: '"A"', state: "" },
                            { value: '"B"', state: "" },
                            { value: '"C"', state: "" }
                        ],
                        highlightCode: [3],
                        groupsChange: '<span class="update-text">æŸ¥æ‰¾ Movable</span>',
                        slotsChange: "ä¸å˜",
                        info: "æœŸæœ› key=\"C\"ï¼Œå½“å‰ key=\"A\"<br><br>åœ¨åç»­ Group ä¸­<span class='update-text'>æŸ¥æ‰¾</span> key=\"C\"...<br>âœ… æ‰¾åˆ°äº†ï¼åœ¨ç´¢å¼• 5"
                    },
                    {
                        phase: "move",
                        stateChange: 'items = ["C", "A", "B"]',
                        groups: [
                            { key: "ItemList", type: "Restartable" },
                            { key: 'key="C"', type: "Movable", state: "new" },
                            { key: "Item-C", type: "Node", state: "new" },
                            { key: 'key="A"', type: "Movable" },
                            { key: "Item-A", type: "Node" },
                            { key: 'key="B"', type: "Movable" },
                            { key: "Item-B", type: "Node" }
                        ],
                        slots: [
                            { value: '"C"', state: "new-value" },
                            { value: '"A"', state: "" },
                            { value: '"B"', state: "" }
                        ],
                        highlightCode: [3, 4],
                        groupsChange: '<span class="highlight-text">ç§»åŠ¨å®Œæˆ</span>',
                        slotsChange: '<span class="highlight-text">é¡ºåºè°ƒæ•´</span>',
                        info: "<span class='highlight-text'>ç§»åŠ¨</span> key=\"C\" çš„ Group åˆ°ç´¢å¼• 1<br><br>âœ… ç§»åŠ¨æ“ä½œ<span class='highlight-text'>ä¿ç•™äº†æ‰€æœ‰çŠ¶æ€</span>ï¼<br>æ¯”åˆ é™¤+é‡å»ºé«˜æ•ˆå¾—å¤šã€‚"
                    },
                    {
                        phase: "complete",
                        stateChange: 'items = ["C", "A", "B"]',
                        groups: [
                            { key: "ItemList", type: "Restartable" },
                            { key: 'key="C"', type: "Movable" },
                            { key: "Item-C", type: "Node" },
                            { key: 'key="A"', type: "Movable" },
                            { key: "Item-A", type: "Node" },
                            { key: 'key="B"', type: "Movable" },
                            { key: "Item-B", type: "Node" }
                        ],
                        slots: [
                            { value: '"C"', state: "" },
                            { value: '"A"', state: "" },
                            { value: '"B"', state: "" }
                        ],
                        highlightCode: [],
                        groupsChange: '<span class="highlight-text">é¡ºåºæ”¹å˜</span>',
                        slotsChange: '<span class="highlight-text">é¡ºåºæ”¹å˜</span>',
                        info: "âœ… åˆ—è¡¨é‡æ’å®Œæˆï¼<br><br>ğŸ‰ ä½¿ç”¨ <span class='highlight-text'>key()</span> çš„ä¼˜åŠ¿ï¼š<br>- çŠ¶æ€ä¿ç•™ï¼ˆrememberã€å‰¯ä½œç”¨ï¼‰<br>- æ€§èƒ½æ›´å¥½ï¼ˆç§»åŠ¨ vs é‡å»ºï¼‰<br>- åŠ¨ç”»æ›´æµç•…"
                    }
                ]
            }
        ];

        let currentScenario = 0;
        let currentStep = 0;

        function selectScenario(idx) {
            currentScenario = idx;
            document.querySelectorAll('.scenario-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === idx);
            });
            reset();
        }

        function reset() {
            currentStep = 0;
            renderCode();
            renderStep();
            renderStepIndicator();
            document.getElementById('next-btn').disabled = false;
        }

        function renderCode() {
            const scenario = scenarios[currentScenario];
            const container = document.getElementById('code-panel');
            container.innerHTML = '';

            scenario.code.forEach((line, idx) => {
                const div = document.createElement('div');
                div.className = 'code-line';
                div.id = `code-line-${idx}`;
                div.innerHTML = `
                    <span class="line-num">${idx + 1}</span>
                    <span class="code-content">${formatCode(line.text)}</span>
                `;
                container.appendChild(div);
            });
        }

        function formatCode(text) {
            return text
                .replace(/@Composable/g, '<span class="keyword">@Composable</span>')
                .replace(/\b(fun|var|by|if|else)\b/g, '<span class="keyword">$1</span>')
                .replace(/\b(remember|mutableStateOf|key)\b/g, '<span class="function">$1</span>')
                .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>');
        }

        function renderStep() {
            const scenario = scenarios[currentScenario];
            const step = scenario.steps[currentStep];

            // æ›´æ–°çŠ¶æ€ä¿¡æ¯
            document.getElementById('state-change').innerHTML = step.stateChange;
            document.getElementById('groups-change').innerHTML = step.groupsChange;
            document.getElementById('slots-change').innerHTML = step.slotsChange;

            // é«˜äº®ä»£ç è¡Œ
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('highlight', 'changed');
            });
            step.highlightCode.forEach(idx => {
                const line = document.getElementById(`code-line-${idx}`);
                if (line) line.classList.add('highlight');
            });

            // æ¸²æŸ“ Groups
            const groupsContainer = document.getElementById('groups-array');
            groupsContainer.innerHTML = '';
            step.groups.forEach(group => {
                const cell = document.createElement('div');
                cell.className = `group-cell ${group.type === 'Node' ? 'node-group' : ''} ${group.state || ''}`;
                cell.innerHTML = `
                    <span class="group-key">${group.key}</span>
                    <span class="group-type">${group.type}</span>
                `;
                groupsContainer.appendChild(cell);
            });

            // æ¸²æŸ“ Slots
            const slotsContainer = document.getElementById('slots-array');
            slotsContainer.innerHTML = '';
            step.slots.forEach(slot => {
                const cell = document.createElement('div');
                cell.className = `slot-cell ${slot.state || ''}`;
                cell.textContent = slot.value;
                slotsContainer.appendChild(cell);
            });

            // æ›´æ–°è¯´æ˜
            document.getElementById('info-text').innerHTML = step.info;
        }

        function renderStepIndicator() {
            const scenario = scenarios[currentScenario];
            const container = document.getElementById('step-indicator');
            container.innerHTML = '';

            scenario.steps.forEach((_, idx) => {
                const dot = document.createElement('div');
                dot.className = 'step-dot';
                if (idx < currentStep) dot.classList.add('completed');
                if (idx === currentStep) dot.classList.add('active');
                container.appendChild(dot);
            });
        }

        function nextStep() {
            const scenario = scenarios[currentScenario];
            currentStep++;

            if (currentStep >= scenario.steps.length) {
                document.getElementById('next-btn').disabled = true;
                currentStep = scenario.steps.length - 1;
            }

            renderStep();
            renderStepIndicator();
        }

        // åˆå§‹åŒ–
        reset();
    </script>
</body>
</html>
