<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ç”¨æ± æœºåˆ¶æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Monaco', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            background: #0f0f23;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 30px;
            max-width: 1300px;
            margin: 0 auto;
            border: 1px solid #333;
        }

        h2 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* åœºæ™¯é€‰æ‹©å™¨ */
        .scenario-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: 2px solid #333;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #1a1a2e;
            color: #aaa;
        }

        .scenario-btn:hover {
            border-color: #00d9ff;
            color: #00d9ff;
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
            border-color: #00d9ff;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 200px 1fr;
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }

        .panel {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            min-height: 350px;
        }

        .panel-title {
            font-size: 14px;
            font-weight: bold;
            color: #00d9ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: #00d9ff;
            border-radius: 2px;
        }

        /* ä¸­é—´ç®­å¤´åŒº */
        .arrow-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 40px;
            padding: 40px 10px;
        }

        .arrow-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            opacity: 0.3;
            transition: all 0.4s ease;
        }

        .arrow-container.active {
            opacity: 1;
        }

        .arrow-container.deactivate svg {
            fill: #f5b041;
        }

        .arrow-container.reuse svg {
            fill: #9b59b6;
        }

        .arrow-container svg {
            width: 50px;
            height: 30px;
            fill: #555;
            transition: all 0.3s ease;
        }

        .arrow-label {
            font-size: 11px;
            color: #888;
            text-align: center;
        }

        .arrow-container.active .arrow-label {
            color: #fff;
        }

        /* Subcomposition å¡ç‰‡ */
        .slot-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slot-card {
            background: #0d1117;
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #333;
            transition: all 0.4s ease;
        }

        .slot-card.highlight-out {
            border-color: #f5b041;
            animation: slideOut 0.5s ease forwards;
        }

        .slot-card.highlight-in {
            border-color: #9b59b6;
            animation: slideIn 0.5s ease;
        }

        .slot-card.active {
            border-color: #58d68d;
        }

        .slot-card.deactivated {
            border-color: #f5b041;
            opacity: 0.8;
        }

        @keyframes slideOut {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(50px); opacity: 0; }
        }

        @keyframes slideIn {
            0% { transform: translateX(-50px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slot-id {
            font-size: 12px;
            font-weight: bold;
            color: #00d9ff;
        }

        .slot-type {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(88, 214, 141, 0.2);
            color: #58d68d;
        }

        .slot-type.text { background: rgba(93, 173, 226, 0.2); color: #5dade2; }
        .slot-type.image { background: rgba(155, 89, 182, 0.2); color: #9b59b6; }
        .slot-type.video { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }

        .slot-content {
            font-size: 11px;
            color: #888;
        }

        .slot-content span {
            color: #58d68d;
        }

        .empty-state {
            color: #555;
            font-size: 12px;
            text-align: center;
            padding: 30px;
        }

        /* å¤ç”¨æ± å®¹é‡æŒ‡ç¤ºå™¨ */
        .pool-capacity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #0d1117;
            border-radius: 6px;
        }

        .capacity-bar {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: linear-gradient(90deg, #58d68d, #f5b041);
            border-radius: 4px;
            transition: width 0.4s ease;
        }

        .capacity-text {
            font-size: 11px;
            color: #aaa;
            min-width: 50px;
            text-align: right;
        }

        /* æ“ä½œæ—¥å¿— */
        .log-panel {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            margin-top: 20px;
        }

        .log-list {
            max-height: 120px;
            overflow-y: auto;
        }

        .log-item {
            font-size: 11px;
            padding: 6px 10px;
            margin-bottom: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .log-item.deactivate { background: rgba(245, 176, 65, 0.1); color: #f5b041; }
        .log-item.reuse { background: rgba(155, 89, 182, 0.1); color: #9b59b6; }
        .log-item.create { background: rgba(93, 173, 226, 0.1); color: #5dade2; }
        .log-item.dispose { background: rgba(236, 112, 99, 0.1); color: #ec7063; }

        /* æ§åˆ¶åŒº */
        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }

        .btn-secondary {
            background: #333;
            color: #aaa;
        }

        .btn-secondary:hover {
            background: #444;
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* è¯´æ˜åŒº */
        .explanation {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: #aaa;
            line-height: 1.6;
        }

        .explanation strong {
            color: #00d9ff;
        }

        .explanation code {
            background: #0d1117;
            padding: 2px 6px;
            border-radius: 4px;
            color: #58d68d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>å¤ç”¨æ± æœºåˆ¶æ¼”ç¤º</h2>
        <p class="subtitle">å±•ç¤º Subcomposition å¦‚ä½•è¢«åœç”¨ã€ç¼“å­˜å’Œå¤ç”¨</p>

        <div class="scenario-selector">
            <button class="scenario-btn active" data-scenario="basic">åŸºç¡€å¤ç”¨</button>
            <button class="scenario-btn" data-scenario="contentType">contentType å¤ç”¨</button>
            <button class="scenario-btn" data-scenario="overflow">æ± æº¢å‡ºå¤„ç†</button>
        </div>

        <div class="main-layout">
            <!-- æ´»è·ƒåˆ—è¡¨ -->
            <div class="panel">
                <div class="panel-title">æ´»è·ƒçš„ Subcomposition</div>
                <div class="slot-list" id="active-list"></div>
            </div>

            <!-- ç®­å¤´åŒº -->
            <div class="arrow-panel">
                <div class="arrow-container deactivate" id="arrow-deactivate">
                    <svg viewBox="0 0 50 30">
                        <path d="M5 15 L35 15 M28 8 L35 15 L28 22" stroke="currentColor" stroke-width="3" fill="none"/>
                    </svg>
                    <div class="arrow-label">åœç”¨<br>deactivate</div>
                </div>
                <div class="arrow-container reuse" id="arrow-reuse">
                    <svg viewBox="0 0 50 30">
                        <path d="M45 15 L15 15 M22 8 L15 15 L22 22" stroke="currentColor" stroke-width="3" fill="none"/>
                    </svg>
                    <div class="arrow-label">å¤ç”¨<br>reuse</div>
                </div>
            </div>

            <!-- å¤ç”¨æ±  -->
            <div class="panel">
                <div class="panel-title">å¤ç”¨æ±  (Reuse Pool)</div>
                <div class="pool-capacity">
                    <span style="font-size: 11px; color: #888;">å®¹é‡:</span>
                    <div class="capacity-bar">
                        <div class="capacity-fill" id="capacity-fill" style="width: 0%"></div>
                    </div>
                    <span class="capacity-text" id="capacity-text">0/3</span>
                </div>
                <div class="slot-list" id="pool-list"></div>
            </div>
        </div>

        <!-- æ—¥å¿— -->
        <div class="log-panel">
            <div class="panel-title">æ“ä½œæ—¥å¿—</div>
            <div class="log-list" id="log-list"></div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="btn-next">ä¸‹ä¸€æ­¥</button>
            <button class="btn btn-secondary" id="btn-reset">é‡ç½®</button>
            <button class="btn btn-secondary" id="btn-auto">è‡ªåŠ¨æ’­æ”¾</button>
        </div>

        <div class="explanation" id="explanation">
            <strong>ğŸ’¡ é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹æ¼”ç¤º</strong><br>
            å¤ç”¨æ± æ˜¯ SubcomposeLayout æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæœºåˆ¶ã€‚åœç”¨çš„ Subcomposition ä¼šè¢«ç¼“å­˜ï¼Œä¾›åç»­å¤ç”¨ã€‚
        </div>
    </div>

    <script>
        const maxPoolSize = 3;
        let currentScenario = 'basic';
        let currentStep = 0;
        let autoPlayInterval = null;

        let activeSlots = [];
        let poolSlots = [];

        const scenarios = {
            basic: {
                name: 'åŸºç¡€å¤ç”¨',
                steps: [
                    {
                        action: 'init',
                        activeSlots: [
                            { id: 'A', type: 'text', content: 'Item A' },
                            { id: 'B', type: 'text', content: 'Item B' },
                            { id: 'C', type: 'text', content: 'Item C' }
                        ],
                        poolSlots: [],
                        explanation: '<strong>ğŸ’¡ åˆå§‹çŠ¶æ€</strong><br>å½“å‰æœ‰ 3 ä¸ªæ´»è·ƒçš„ Subcomposition (A, B, C)ï¼Œå¤ç”¨æ± ä¸ºç©ºã€‚'
                    },
                    {
                        action: 'deactivate',
                        target: 'A',
                        explanation: '<strong>ğŸ’¡ åœç”¨ A</strong><br>è°ƒç”¨ç»“æŸåï¼ŒA ä¸å†è¢«ä½¿ç”¨ã€‚å°† A ç§»å…¥å¤ç”¨æ± ï¼Œä¿ç•™å…¶ SlotTable å’ŒçŠ¶æ€ã€‚'
                    },
                    {
                        action: 'deactivate',
                        target: 'B',
                        explanation: '<strong>ğŸ’¡ åœç”¨ B</strong><br>B ä¹Ÿä¸å†éœ€è¦ï¼Œç§»å…¥å¤ç”¨æ± ã€‚ç°åœ¨æ± ä¸­æœ‰ A å’Œ Bã€‚'
                    },
                    {
                        action: 'reuse',
                        newId: 'D',
                        reuseFrom: 'A',
                        explanation: '<strong>ğŸ’¡ å¤ç”¨åˆ›å»º D</strong><br>éœ€è¦æ˜¾ç¤ºæ–°å†…å®¹ Dã€‚ä»å¤ç”¨æ± å–å‡º Aï¼ˆFIFOï¼‰ï¼Œé‡æ–°ç»„åˆä¸º Dã€‚é¿å…äº†åˆ›å»ºæ–° Subcomposition çš„å¼€é”€ã€‚'
                    },
                    {
                        action: 'reuse',
                        newId: 'E',
                        reuseFrom: 'B',
                        explanation: '<strong>ğŸ’¡ å¤ç”¨åˆ›å»º E</strong><br>ç»§ç»­éœ€è¦ Eï¼Œä»æ± ä¸­å–å‡º B å¤ç”¨ã€‚å¤ç”¨æ± ç°åœ¨ä¸ºç©ºã€‚'
                    }
                ]
            },
            contentType: {
                name: 'contentType å¤ç”¨',
                steps: [
                    {
                        action: 'init',
                        activeSlots: [
                            { id: 'Text1', type: 'text', content: 'æ–‡æœ¬æ¶ˆæ¯' },
                            { id: 'Image1', type: 'image', content: 'å›¾ç‰‡æ¶ˆæ¯' }
                        ],
                        poolSlots: [
                            { id: 'Text0', type: 'text', content: '(ç¼“å­˜)' },
                            { id: 'Image0', type: 'image', content: '(ç¼“å­˜)' }
                        ],
                        explanation: '<strong>ğŸ’¡ å¸¦ contentType çš„å¤ç”¨æ± </strong><br>å¤ç”¨æ± æŒ‰ <code>contentType</code> åˆ†ç±»å­˜å‚¨ã€‚Text ç±»å‹å’Œ Image ç±»å‹åˆ†å¼€ç®¡ç†ã€‚'
                    },
                    {
                        action: 'reuse_typed',
                        newId: 'Text2',
                        type: 'text',
                        reuseFrom: 'Text0',
                        explanation: '<strong>ğŸ’¡ æŒ‰ç±»å‹å¤ç”¨ - æ–‡æœ¬</strong><br>éœ€è¦æ–°çš„æ–‡æœ¬æ¶ˆæ¯ã€‚ä¼˜å…ˆä»ç›¸åŒ <code>contentType="text"</code> çš„æ± ä¸­è·å–ï¼Œå¤ç”¨ Text0ã€‚ç»“æ„ç›¸ä¼¼ï¼Œé‡ç»„å¼€é”€å°ã€‚'
                    },
                    {
                        action: 'reuse_typed',
                        newId: 'Image2',
                        type: 'image',
                        reuseFrom: 'Image0',
                        explanation: '<strong>ğŸ’¡ æŒ‰ç±»å‹å¤ç”¨ - å›¾ç‰‡</strong><br>éœ€è¦æ–°çš„å›¾ç‰‡æ¶ˆæ¯ã€‚ä» <code>contentType="image"</code> æ± ä¸­è·å– Image0ã€‚ç±»å‹åŒ¹é…ï¼Œå¤ç”¨æ•ˆç‡æœ€é«˜ã€‚'
                    },
                    {
                        action: 'create_new',
                        newId: 'Video1',
                        type: 'video',
                        explanation: '<strong>ğŸ’¡ æ— åŒ¹é…ç±»å‹ - æ–°å»º</strong><br>éœ€è¦è§†é¢‘æ¶ˆæ¯ï¼Œä½†æ± ä¸­æ²¡æœ‰ <code>contentType="video"</code>ã€‚åªèƒ½åˆ›å»ºæ–°çš„ Subcompositionã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ contentType çš„åŸå› ã€‚'
                    }
                ]
            },
            overflow: {
                name: 'æ± æº¢å‡ºå¤„ç†',
                steps: [
                    {
                        action: 'init',
                        activeSlots: [
                            { id: 'A', type: 'text', content: 'Item A' }
                        ],
                        poolSlots: [
                            { id: 'X', type: 'text', content: '(æœ€æ—©)' },
                            { id: 'Y', type: 'text', content: '(ä¸­é—´)' },
                            { id: 'Z', type: 'text', content: '(æœ€æ–°)' }
                        ],
                        explanation: '<strong>ğŸ’¡ å¤ç”¨æ± å·²æ»¡</strong><br>å¤ç”¨æ± å®¹é‡ä¸º 3ï¼Œå½“å‰å·²æ»¡ (X, Y, Z)ã€‚æ´»è·ƒåˆ—è¡¨æœ‰ Aã€‚'
                    },
                    {
                        action: 'deactivate_overflow',
                        target: 'A',
                        dispose: 'X',
                        explanation: '<strong>ğŸ’¡ åœç”¨å¯¼è‡´æº¢å‡º</strong><br>A è¦åœç”¨ï¼Œä½†æ± å·²æ»¡ã€‚é‡‡ç”¨ FIFO ç­–ç•¥ï¼š<strong>é‡Šæ”¾æœ€æ—©çš„ X</strong>ï¼ˆé”€æ¯ SlotTableï¼Œè§¦å‘ onDisposeï¼‰ï¼Œç„¶å A è¿›å…¥æ± å°¾ã€‚'
                    },
                    {
                        action: 'show_result',
                        explanation: '<strong>ğŸ’¡ æº¢å‡ºå¤„ç†ç»“æœ</strong><br>X å·²è¢«é‡Šæ”¾ï¼ˆå†…å­˜å›æ”¶ï¼‰ï¼Œæ± ä¸­ç°åœ¨æ˜¯ [Y, Z, A]ã€‚åˆç†çš„æ± å¤§å°èƒ½å¹³è¡¡å†…å­˜å ç”¨å’Œå¤ç”¨æ•ˆç‡ã€‚'
                    }
                ]
            }
        };

        function renderActiveList() {
            const container = document.getElementById('active-list');
            if (activeSlots.length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— æ´»è·ƒçš„ Subcomposition</div>';
                return;
            }
            container.innerHTML = activeSlots.map(s => `
                <div class="slot-card active ${s.animClass || ''}" data-id="${s.id}">
                    <div class="slot-header">
                        <span class="slot-id">slotId="${s.id}"</span>
                        <span class="slot-type ${s.type}">${s.type}</span>
                    </div>
                    <div class="slot-content">${s.content}</div>
                </div>
            `).join('');
        }

        function renderPoolList() {
            const container = document.getElementById('pool-list');
            const capacityFill = document.getElementById('capacity-fill');
            const capacityText = document.getElementById('capacity-text');

            capacityFill.style.width = `${(poolSlots.length / maxPoolSize) * 100}%`;
            capacityText.textContent = `${poolSlots.length}/${maxPoolSize}`;

            if (poolSlots.length === 0) {
                container.innerHTML = '<div class="empty-state">å¤ç”¨æ± ä¸ºç©º</div>';
                return;
            }
            container.innerHTML = poolSlots.map(s => `
                <div class="slot-card deactivated ${s.animClass || ''}" data-id="${s.id}">
                    <div class="slot-header">
                        <span class="slot-id">slotId="${s.id}"</span>
                        <span class="slot-type ${s.type}">${s.type}</span>
                    </div>
                    <div class="slot-content">${s.content}</div>
                </div>
            `).join('');
        }

        function addLog(type, message) {
            const logList = document.getElementById('log-list');
            const icons = { deactivate: 'â¸ï¸', reuse: 'â™»ï¸', create: 'ğŸ†•', dispose: 'ğŸ—‘ï¸' };
            const log = document.createElement('div');
            log.className = `log-item ${type}`;
            log.innerHTML = `<span>${icons[type]}</span>${message}`;
            logList.insertBefore(log, logList.firstChild);
        }

        function highlightArrow(type) {
            document.querySelectorAll('.arrow-container').forEach(el => el.classList.remove('active'));
            if (type) {
                document.getElementById(`arrow-${type}`).classList.add('active');
            }
        }

        function executeStep() {
            const scenario = scenarios[currentScenario];
            const step = scenario.steps[currentStep];

            document.getElementById('explanation').innerHTML = step.explanation;
            highlightArrow(null);

            switch (step.action) {
                case 'init':
                    activeSlots = JSON.parse(JSON.stringify(step.activeSlots));
                    poolSlots = JSON.parse(JSON.stringify(step.poolSlots));
                    renderActiveList();
                    renderPoolList();
                    break;

                case 'deactivate':
                    highlightArrow('deactivate');
                    const idx = activeSlots.findIndex(s => s.id === step.target);
                    if (idx >= 0) {
                        activeSlots[idx].animClass = 'highlight-out';
                        renderActiveList();
                        setTimeout(() => {
                            const removed = activeSlots.splice(idx, 1)[0];
                            removed.animClass = 'highlight-in';
                            removed.content = '(ç¼“å­˜)';
                            poolSlots.push(removed);
                            renderActiveList();
                            renderPoolList();
                            addLog('deactivate', `${step.target} åœç”¨ï¼Œæ”¾å…¥å¤ç”¨æ± `);
                            setTimeout(() => {
                                poolSlots[poolSlots.length - 1].animClass = '';
                                renderPoolList();
                            }, 500);
                        }, 500);
                    }
                    break;

                case 'reuse':
                    highlightArrow('reuse');
                    const poolIdx = poolSlots.findIndex(s => s.id === step.reuseFrom);
                    if (poolIdx >= 0) {
                        poolSlots[poolIdx].animClass = 'highlight-out';
                        renderPoolList();
                        setTimeout(() => {
                            const reused = poolSlots.splice(poolIdx, 1)[0];
                            reused.id = step.newId;
                            reused.content = `Item ${step.newId}`;
                            reused.animClass = 'highlight-in';
                            activeSlots.push(reused);
                            renderPoolList();
                            renderActiveList();
                            addLog('reuse', `å¤ç”¨ ${step.reuseFrom} â†’ åˆ›å»º ${step.newId}`);
                            setTimeout(() => {
                                activeSlots[activeSlots.length - 1].animClass = '';
                                renderActiveList();
                            }, 500);
                        }, 500);
                    }
                    break;

                case 'reuse_typed':
                    highlightArrow('reuse');
                    const typedIdx = poolSlots.findIndex(s => s.type === step.type);
                    if (typedIdx >= 0) {
                        poolSlots[typedIdx].animClass = 'highlight-out';
                        renderPoolList();
                        setTimeout(() => {
                            const reused = poolSlots.splice(typedIdx, 1)[0];
                            reused.id = step.newId;
                            reused.content = step.type === 'text' ? 'æ–‡æœ¬æ¶ˆæ¯' : 'å›¾ç‰‡æ¶ˆæ¯';
                            reused.animClass = 'highlight-in';
                            activeSlots.push(reused);
                            renderPoolList();
                            renderActiveList();
                            addLog('reuse', `æŒ‰ contentType="${step.type}" å¤ç”¨ â†’ ${step.newId}`);
                            setTimeout(() => {
                                activeSlots[activeSlots.length - 1].animClass = '';
                                renderActiveList();
                            }, 500);
                        }, 500);
                    }
                    break;

                case 'create_new':
                    activeSlots.push({
                        id: step.newId,
                        type: step.type,
                        content: 'è§†é¢‘æ¶ˆæ¯',
                        animClass: 'highlight-in'
                    });
                    renderActiveList();
                    addLog('create', `æ± ä¸­æ—  contentType="${step.type}"ï¼Œæ–°å»º ${step.newId}`);
                    setTimeout(() => {
                        activeSlots[activeSlots.length - 1].animClass = '';
                        renderActiveList();
                    }, 500);
                    break;

                case 'deactivate_overflow':
                    highlightArrow('deactivate');
                    const aIdx = activeSlots.findIndex(s => s.id === step.target);
                    if (aIdx >= 0) {
                        activeSlots[aIdx].animClass = 'highlight-out';
                        renderActiveList();
                        setTimeout(() => {
                            // å…ˆé‡Šæ”¾æœ€æ—©çš„
                            const disposed = poolSlots.shift();
                            addLog('dispose', `æ± æ»¡ï¼Œé‡Šæ”¾ ${disposed.id}ï¼ˆSlotTable é”€æ¯ï¼‰`);

                            // A è¿›å…¥æ± 
                            const removed = activeSlots.splice(aIdx, 1)[0];
                            removed.animClass = 'highlight-in';
                            removed.content = '(ç¼“å­˜)';
                            poolSlots.push(removed);
                            renderActiveList();
                            renderPoolList();
                            addLog('deactivate', `${step.target} åœç”¨ï¼Œè¿›å…¥å¤ç”¨æ± `);
                            setTimeout(() => {
                                poolSlots[poolSlots.length - 1].animClass = '';
                                renderPoolList();
                            }, 500);
                        }, 500);
                    }
                    break;

                case 'show_result':
                    // ä»…æ˜¾ç¤ºè¯´æ˜
                    break;
            }
        }

        function nextStep() {
            const scenario = scenarios[currentScenario];
            if (currentStep < scenario.steps.length - 1) {
                currentStep++;
                executeStep();
            }
            document.getElementById('btn-next').disabled = currentStep >= scenario.steps.length - 1;
        }

        function reset() {
            currentStep = 0;
            document.getElementById('log-list').innerHTML = '';
            document.getElementById('btn-next').disabled = false;
            highlightArrow(null);
            executeStep();

            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('btn-auto').textContent = 'è‡ªåŠ¨æ’­æ”¾';
            }
        }

        function selectScenario(scenario) {
            currentScenario = scenario;
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.scenario === scenario);
            });
            reset();
        }

        function toggleAutoPlay() {
            const btn = document.getElementById('btn-auto');
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                btn.textContent = 'è‡ªåŠ¨æ’­æ”¾';
            } else {
                btn.textContent = 'åœæ­¢æ’­æ”¾';
                autoPlayInterval = setInterval(() => {
                    const scenario = scenarios[currentScenario];
                    if (currentStep < scenario.steps.length - 1) {
                        nextStep();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                        btn.textContent = 'è‡ªåŠ¨æ’­æ”¾';
                    }
                }, 2000);
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.querySelectorAll('.scenario-btn').forEach(btn => {
            btn.addEventListener('click', () => selectScenario(btn.dataset.scenario));
        });
        document.getElementById('btn-next').addEventListener('click', nextStep);
        document.getElementById('btn-reset').addEventListener('click', reset);
        document.getElementById('btn-auto').addEventListener('click', toggleAutoPlay);

        // åˆå§‹åŒ–
        reset();
    </script>
</body>
</html>
