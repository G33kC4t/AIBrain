# 图表模式

专业图表的设计模式和技巧。

## 流程图

### 标准符号

| 图形 | 含义 | Excalidraw 类型 | 颜色建议 |
|------|------|-----------------|----------|
| 椭圆/圆角矩形 | 开始/结束 | `ellipse` 或 `rectangle` + `roundness` | `#b2f2bb` 绿 |
| 矩形 | 处理/动作 | `rectangle` | `#a5d8ff` 蓝 |
| 菱形 | 决策 | `diamond` | `#ffec99` 黄 |
| 平行四边形 | 输入/输出 | `rectangle`（旋转）或用线条 | `#e9ecef` 灰 |
| 圆形 | 连接点/引用 | `ellipse`（正圆） | `#e9ecef` 灰 |

### 泳道流程图

按职责分区组织：

```
┌─────────────────┬─────────────────┬─────────────────┐
│     用户        │     系统        │    数据库       │
├─────────────────┼─────────────────┼─────────────────┤
│  ┌─────────┐    │                 │                 │
│  │  请求   │────┼──►┌─────────┐   │                 │
│  └─────────┘    │   │  处理   │───┼──►┌─────────┐   │
│                 │   └─────────┘   │   │  查询   │   │
│                 │                 │   └─────────┘   │
└─────────────────┴─────────────────┴─────────────────┘
```

**实现要点**：
- 泳道边界用大矩形：`backgroundColor: "transparent"`, `strokeStyle: "dashed"`
- 泳道标题置于顶部，粗体文本
- 元素保持在各自泳道内
- 水平箭头跨越泳道边界

### 流程图布局

- **方向**：上→下 或 左→右
- **元素间距**：100px
- **决策分支**：标注 Yes/No 或 是/否
- **箭头颜色**：Yes 用绿色 `#2f9e44`，No 用红色 `#e03131`

---

## 时序图

### 核心组件

**1. 参与者（顶部行）**
```json
{
  "type": "rectangle",
  "backgroundColor": "#a5d8ff",
  "width": 100,
  "height": 50,
  "roundness": { "type": 3 }
}
```

**2. 生命线（垂直虚线）**
```json
{
  "type": "line",
  "strokeStyle": "dashed",
  "strokeWidth": 1,
  "roughness": 0,
  "points": [[0, 0], [0, 400]]
}
```

**3. 同步消息（实线箭头）**
```json
{
  "type": "arrow",
  "strokeStyle": "solid",
  "endArrowhead": "arrow"
}
```

**4. 异步消息（虚线箭头）**
```json
{
  "type": "arrow",
  "strokeStyle": "dashed",
  "endArrowhead": "arrow"
}
```

**5. 返回消息（虚线，指回）**
```json
{
  "type": "arrow",
  "strokeStyle": "dashed",
  "strokeColor": "#868e96",
  "endArrowhead": "arrow"
}
```

**6. 激活框（生命线上的细矩形）**
```json
{
  "type": "rectangle",
  "width": 16,
  "height": 80,
  "backgroundColor": "#e9ecef",
  "strokeWidth": 1
}
```

### 时序图布局

```
     用户          认证          数据库
      │             │               │
      │───登录────►│               │
      │             │──查询用户──►│
      │             │◄──用户数据───│
      │◄──令牌─────│               │
      │             │               │
```

- **参与者间距**：200px
- **消息垂直间距**：50-80px
- **消息标签**：置于箭头上方
- **消息编号**：复杂流程用 "1. 登录", "2. 验证" 等

---

## 思维导图

### 放射状布局

中心思想向外辐射分支：

```
                    ┌─────────┐
                    │  主题A  │
                    └────┬────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
   ┌────┴────┐     ┌─────┴─────┐    ┌────┴────┐
   │  子1    │     │   中心    │    │  子2    │
   └─────────┘     │   主题    │    └─────────┘
                   └─────┬─────┘
                         │
                    ┌────┴────┐
                    │  主题B  │
                    └─────────┘
```

### 颜色策略

- **中心**：醒目色（`#228be6` 蓝 或 `#7950f2` 紫）
- **一级分支**：每个分支不同颜色
- **二级及以下**：父级颜色的浅色调

### 分支样式

- 曲线（多点）营造有机感
- 线条粗细从中心向外递减：`strokeWidth: 4` → `2` → `1`
- 分支角度 45-60°

### 层级尺寸

| 层级 | 字号 | 图形尺寸 | 线宽 |
|------|------|----------|------|
| 中心 | 28-36 | 180×100 | 4 |
| 一级 | 20-24 | 140×70 | 2 |
| 二级 | 16-18 | 100×50 | 2 |
| 三级 | 14-16 | 80×40 | 1 |

---

## 软件架构图

### 分层架构

垂直堆叠组件，明确边界：

```
┌─────────────────────────────────────────┐
│           表现层                        │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │   Web   │  │ Mobile  │  │   API   │  │
│  └─────────┘  └─────────┘  └─────────┘  │
├─────────────────────────────────────────┤
│            业务层                       │
│  ┌─────────────────────────────────┐    │
│  │         服务逻辑                │    │
│  └─────────────────────────────────┘    │
├─────────────────────────────────────────┤
│              数据层                     │
│  ┌─────────┐         ┌─────────┐        │
│  │   DB    │         │  Cache  │        │
│  └─────────┘         └─────────┘        │
└─────────────────────────────────────────┘
```

**层级颜色（上→下）**：
- 表现层：`#a5d8ff` 蓝
- 业务层：`#b2f2bb` 绿
- 数据层：`#d0bfff` 紫

### 微服务模式

独立服务 + API 网关：

```
                    ┌─────────────┐
                    │   客户端    │
                    └──────┬──────┘
                           │
                    ┌──────┴──────┐
                    │ API Gateway │
                    └──────┬──────┘
           ┌───────────────┼───────────────┐
           │               │               │
    ┌──────┴──────┐ ┌──────┴──────┐ ┌──────┴──────┐
    │  服务 A     │ │  服务 B     │ │  服务 C     │
    └──────┬──────┘ └──────┬──────┘ └──────┬──────┘
           │               │               │
    ┌──────┴──────┐ ┌──────┴──────┐ ┌──────┴──────┐
    │    DB A     │ │    DB B     │ │    DB C     │
    └─────────────┘ └─────────────┘ └─────────────┘
```

### 组件图形

| 组件 | 图形 | 颜色 |
|------|------|------|
| 用户/客户端 | 椭圆或小人图标 | `#a5d8ff` 蓝 |
| 服务/API | 矩形 | `#b2f2bb` 绿 |
| 数据库 | 椭圆（圆柱感） | `#d0bfff` 紫 |
| 队列/消息 | 矩形（波浪边） | `#ffec99` 黄 |
| 外部系统 | 矩形（双边框） | `#e9ecef` 灰 |
| 负载均衡 | 菱形 | `#99e9f2` 青 |

---

## 数据流图 (DFD)

### Yourdon-Coad 符号

| 符号 | 含义 | Excalidraw |
|------|------|------------|
| 圆形 | 处理 | `ellipse` |
| 矩形 | 外部实体 | `rectangle` |
| 开口矩形 | 数据存储 | `rectangle`（一边无边框）用线条 |
| 箭头 | 数据流 | `arrow` |

### Gane-Sarson 符号

| 符号 | 含义 | Excalidraw |
|------|------|------------|
| 圆角矩形 | 处理 | `rectangle` + `roundness` |
| 矩形 | 外部实体 | `rectangle` |
| 开口矩形 | 数据存储 | 同上 |
| 箭头 | 数据流 | `arrow` |

### DFD 层级

- **上下文图（Level 0）**：单一处理，仅外部实体
- **Level 1**：主要处理，出现数据存储
- **Level 2+**：详细子处理

### 布局技巧

- 外部实体置于边缘
- 处理置于中心
- 数据存储置于相关处理之间
- 每条箭头标注数据名称

---

## 实体关系图 (ERD)

### ER 符号

```
┌─────────────┐         ┌─────────────┐
│   实体A     │         │   实体B     │
├─────────────┤         ├─────────────┤
│ 属性1       │─────────│ 属性1       │
│ 属性2       │   1:N   │ 属性2       │
│ *主键*      │         │ *主键*      │
└─────────────┘         └─────────────┘
```

### 基数标记

用文本标签或鱼尾符号：
- `1` - 一个
- `N` 或 `*` - 多个
- `0..1` - 零或一
- `1..*` - 一或多

---

## 通用专业模式

### 一致性样式规则

1. **所有图表**：`roughness: 1`, `strokeWidth: 2`
2. **正式/技术**：`roughness: 0`, `fontFamily: 2`（Helvetica）
3. **休闲/头脑风暴**：`roughness: 2`, `fontFamily: 1`（Virgil）

### 视觉层次

```
标题（36px，粗描边）
    │
    ├── 主要元素（20px，彩色背景）
    │       │
    │       └── 次要元素（16px，浅色）
    │               │
    │               └── 细节（14px，灰色文本）
    │
    └── 注释（12px，虚线边框）
```

### 箭头约定

| 样式 | 含义 |
|------|------|
| 实线 + 箭头 | 主要流程、动作 |
| 虚线 + 箭头 | 响应、返回、异步 |
| 实线 + 无头 | 关联、关系 |
| 点线 + 箭头 | 可选、引用 |
| 粗实线 | 主要/关键路径 |

### 专业配色方案

**企业/正式**：
- 主色：`#228be6` 蓝
- 辅色：`#868e96` 灰
- 背景：`#f8f9fa`

**友好/创业**：
- 主色：`#7950f2` 紫
- 辅色：`#20c997` 青
- 点缀：`#ff922b` 橙

**技术/工程**：
- 主色：`#1e1e1e` 黑
- 背景：`#e9ecef` 浅灰
- 点缀：`#228be6` 蓝

---

## 快速参考

| 图表类型 | 关键图形 | 流向 | 适用场景 |
|----------|----------|------|----------|
| 流程图 | 矩形, 菱形 | 上→下 | 流程、算法 |
| 时序图 | 矩形, 线条, 箭头 | 左→右（时间） | 交互、API |
| 思维导图 | 椭圆, 线条 | 中心→外 | 头脑风暴、概念 |
| 架构图 | 矩形, 层次 | 上→下 | 系统、基础设施 |
| DFD | 圆形, 矩形 | 多向 | 数据流动 |
| ERD | 矩形, 线条 | 无固定 | 数据库设计 |
| 线框图 | 矩形, 文本 | 无固定 | UI/UX 设计 |
